
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n L√Ω Kh√≥a H·ªçc ‚Ä¢ JSON driven</title>

  <!-- ‚ñ∏ Styles & fonts -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- ‚ñ∏ Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

 
</head>
<body>
  <div class="app-container">

    <main class="content-area">
      <!-- ‚ñ∏ Desktop upcoming highlight -->
      <section id="desktopHighlights" class="upcoming-carousel-wrapper"></section>

      <!-- ‚ñ∏ Search -->
      <section class="search-section">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input id="globalSearch" class="search-input"
                 placeholder="T√¨m ki·∫øm th√¥ng tin kh√≥a h·ªçc, gi·∫£ng vi√™n, ƒë·ªãa ƒëi·ªÉm..."
                 autocomplete="off">
        </div>
      </section>

      <!-- ‚ñ∏ Desktop table -->
      <div class="desktop-table">
        <div class="table-container">
          <table id="courses" class="display nowrap">
            <thead>
              <tr>
                <th>KH√ìA H·ªåC</th>
                <th>GI·∫¢NG VI√äN</th>
                <th>TH·ªúI GIAN</th>
                <th>ƒê·ªäA ƒêI·ªÇM</th>
                <th>H√åNH TH·ª®C</th>
                <!-- <th>H·ªçc ph√≠</th> -->
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- ‚ñ∏ Mobile cards -->
      <div id="mobileCardContainer" class="mobile-card-container"></div>
    </main>
  </div>

  <!-- ‚ñ∏ Mobile Scroll Indicator -->
  <div id="mobileScrollIndicator" class="mobile-scroll-indicator">
    <i class="fas fa-chevron-down mobile-scroll-indicator-icon"></i>
    <span class="mobile-scroll-indicator-text">Vu·ªët ƒë·ªÉ xem th√™m</span>
  </div>

<script>
  const specialCourses = ["Ch√°nh Ki·∫øn 1", "Nh√¢n T∆∞·ªõng H·ªçc", "R√®n Tr√≠ S√°ng Su·ªët", "R√®n T√¢m V·ªØng V√†ng"];

  /* ========================================================================
   *  Helper: b·ªè d·∫•u ti·∫øng Vi·ªát & lo·∫°i k√Ω t·ª± ƒë·∫∑c bi·ªát
   * ======================================================================*/
  const stripVN = str =>
    (str || '')
      .toString()
      .normalize('NFD')                // t√°ch d·∫•u
      .replace(/[\u0300-\u036f]/g, '') // b·ªè d·∫•u
      .replace(/ƒë/g, 'd').replace(/ƒê/g, 'D')
      .replace(/[^\w\s]/g, '')         // b·ªè k√Ω t·ª± l·∫° (‚Ç´, ., , ...)
      .toLowerCase();

  const VND = n => (n || 0).toLocaleString('vi-VN') + ' vnƒë';
  const parseNum = t => parseInt(String(t).replace(/[^\d]/g, '')) || 0;

  const createModeBadge = mode => {
    const online = /online|zoom|tr·ª±c tuy·∫øn/i.test(mode);
    const hybrid = /hybrid|k·∫øt h·ª£p/i.test(mode);
    let cls, icon;
    if (online)      [cls, icon] = ['online',  'fa-video'];
    else if (hybrid) [cls, icon] = ['hybrid',  'fa-people-arrows'];
    else             [cls, icon] = ['offline', 'fa-chalkboard-teacher'];
    return `<span class="mode-badge ${cls}"><i class="fas ${icon}"></i> ${mode || '?'}</span>`;
  };

  /* ====== Custom sort for DD/MM/YYYY & VND ====== */
  $.fn.dataTable.ext.type.order['ddmmyyyy-pre'] = d => {
    if (!d || d.includes('--')) return 0;
    const [dd, mm, yyyy] = d.split('/') || [];
    return new Date(yyyy, mm - 1, dd).getTime() || 0;
  };
  $.fn.dataTable.ext.type.order['vnd-pre'] = t => parseNum(t);

  /* ----------------------------------------------------------------------
   *  üîç  Accent-insensitive, number-friendly SEARCH plug-in
   * -------------------------------------------------------------------- */
  $.fn.dataTable.ext.search.push((settings, data, dataIndex, rowData) => {
    const query = stripVN($('#globalSearch').val().trim().toLowerCase());
    if (!query) return true;

    // Ki·ªÉm tra t·ª´ng c·ªôt c·ªßa d·ªØ li·ªáu g·ªëc
    return Object.values(rowData).some(val => {
      if (typeof val === 'number') {
        // X·ª≠ l√Ω s·ªë ti·ªÅn (tuition) ho·∫∑c c√°c gi√° tr·ªã s·ªë
        return stripVN(VND(val)).includes(query) || String(val).includes(query);
      }
      // X·ª≠ l√Ω chu·ªói (bao g·ªìm HTML)
      const text = typeof val === 'string' ? val : String(val);
      return stripVN($('<div>').html(text).text()).includes(query);
    });
  });

  /* ========================================================================
   *  Data fetching
   * ======================================================================*/
  async function getData() {
    try {
      const res = await fetch('https://webhook.gnh.vn/webhook/event_info', { cache: 'no-store' });
      if (!res.ok) throw new Error(res.status);
      const raw = await res.json();
      return raw
        .filter(x => x.course && x.speaker)
        .map(x => {
          // X·ª≠ l√Ω h·ªçc ph√≠ ƒë·∫∑c bi·ªát
          let processedFee;
          if (x.tuition === "Li√™n h·ªá" || x.tuition === "li√™n h·ªá") {
            processedFee = "Li√™n h·ªá";
          } else if (!x.tuition || x.tuition === "" || x.tuition === null) {
            processedFee = "--";
          } else {
            processedFee = parseNum(x.tuition);
          }

          return {
            start: x.start_date || '--/--/----',
            end: x.end_date || '--/--/----',
            speaker: x.speaker,
            course: x.course,
            loc: x.location || 'N/A',
            mode: x.learning_mode || 'N/A',
            fee: processedFee,
            href: x.href || '#',
            thumbnail: x.thumbnail || '', // Th√™m thumbnail
            description: x.description || '', // Th√™m description
            categories: x.categories || ''  // Th√™m categories
          };
        });
    } catch (err) {
      console.warn('API l·ªói, d√πng d·ªØ li·ªáu demo:', err);
      return [
        { start: '10/06/2025', end: '15/06/2025', speaker: 'API ƒê√£ B·ªã L·ªói', course: 'API ƒê√£ B·ªã L·ªói', loc: 'API ƒê√£ B·ªã L·ªói', mode: 'Tr·ª±c tuy·∫øn', fee: 2000000, href: '#', thumbnail: 'https://via.placeholder.com/289x165/4f46e5/ffffff?text=Python', description: 'API ƒê√£ B·ªã L·ªói', categories: 'L·∫≠p tr√¨nh' },
        { start: '20/06/2025', end: '25/06/2025', speaker: 'API ƒê√£ B·ªã L·ªói', course: 'API ƒê√£ B·ªã L·ªói', loc: 'API ƒê√£ B·ªã L·ªói', mode: 'T·∫°i ch·ªó', fee: 3500000, href: '#', thumbnail: 'https://via.placeholder.com/289x165/7c3aed/ffffff?text=PM', description: 'API ƒê√£ B·ªã L·ªói', categories: 'Qu·∫£n l√Ω' }
      ];
    }
  }

  /* ========================================================================
   *  Mobile card renderer
   * ======================================================================*/
  function fillCards(data) {
    const container = $('#mobileCardContainer').empty();
    if (!data || !data.length) {
      container.html('<p style="text-align:center;padding:1.5rem;color:var(--text-muted)">Kh√¥ng t√¨m th·∫•y kh√≥a h·ªçc ph√π h·ª£p.</p>');
      return;
    }
    
    // D·ªØ li·ªáu cho cards gi·ªù ƒë√£ ƒë∆∞·ª£c l·ªçc tr∆∞·ªõc khi g·ªçi h√†m n√†y.
    // Ch·ªâ c·∫ßn s·∫Øp x·∫øp theo ng√†y b·∫Øt ƒë·∫ßu (g·∫ßn nh·∫•t ·ªü ƒë·∫ßu).
    const sortedData = [...data].sort((a, b) => {
      // H√†m chuy·ªÉn ƒë·ªïi DD/MM/YYYY th√†nh Date object
      const parseDate = (dateStr) => {
        if (!dateStr || dateStr.includes('--')) return new Date(0); // Ng√†y xa nh·∫•t n·∫øu kh√¥ng c√≥
        const [dd, mm, yyyy] = dateStr.split('/');
        return new Date(yyyy, mm - 1, dd); // mm - 1 v√¨ th√°ng trong JS b·∫Øt ƒë·∫ßu t·ª´ 0
      };
      
      const dateA = parseDate(a.start);
      const dateB = parseDate(b.start);
      
      // S·∫Øp x·∫øp tƒÉng d·∫ßn (ng√†y g·∫ßn nh·∫•t ·ªü ƒë·∫ßu)
      return dateA.getTime() - dateB.getTime();
    });
    
    const getModeBadgeClass = mode => {
      const online = /online|zoom|tr·ª±c tuy·∫øn/i.test(mode);
      const hybrid = /hybrid|k·∫øt h·ª£p/i.test(mode);
      return online ? 'online' : hybrid ? 'hybrid' : 'offline';
    };
    
    const getModeIcon = mode => {
      const online = /online|zoom|tr·ª±c tuy·∫øn/i.test(mode);
      const hybrid = /hybrid|k·∫øt h·ª£p/i.test(mode);
      return online ? 'fa-video' : hybrid ? 'fa-people-arrows' : 'fa-chalkboard-teacher';
    };
    
    container.html(sortedData.map(c => {
      const isSpecial = specialCourses.includes(c.course);
      const specialClass = isSpecial ? 'special-course-highlight' : '';

      const formatDM = d => {
        if (!d || d.includes('--')) return '??/??';
        const [dd, mm] = d.split('/');
        return `${dd}/${mm}`;
      };
      
      const dateDisplay = c.start === c.end
        ? formatDM(c.start)
        : `${formatDM(c.start)} - ${formatDM(c.end)}`;

      return `
      <article class="course-card">
        <div class="card-thumbnail-container">
          ${c.thumbnail ? 
            `<img src="${c.thumbnail}" alt="${c.course}" class="card-thumbnail" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
             <div class="card-thumbnail-placeholder" style="display:none;">${c.course}</div>` : 
            `<div class="card-thumbnail-placeholder">${c.course}</div>`
          }
        </div>
        
        <div class="card-header">
          <h3 class="card-title ${specialClass}">${c.course}</h3>
        </div>
        
        <div class="card-body">
          <div class="card-meta">
            <span class="card-mode-badge ${getModeBadgeClass(c.mode)}">
              <i class="fas ${getModeIcon(c.mode)}"></i>
              ${c.mode}
            </span>
          </div>
          
          <div class="card-info-grid">
            <div class="card-info-item">
              <i class="fas fa-user info-icon"></i>
              <span class="info-value">${c.speaker}</span>
            </div>
            <div class="card-info-item">
              <i class="fas fa-calendar info-icon"></i>
              <span class="info-value">${dateDisplay}</span>
            </div>
            <div class="card-info-item">
              <i class="fas fa-map-marker-alt info-icon"></i>
              <span class="info-value">${c.loc}</span>
            </div>
            ${c.categories ? `
            <div class="card-info-item">
              <i class="fas fa-tag info-icon"></i>
              <span class="info-value">${c.categories}</span>
            </div>` : ''}
          </div>
          
          <div class="card-price">${typeof c.fee === 'string' ? c.fee : VND(c.fee)}</div>
          
          ${c.description ? `<div class="card-description">${c.description}</div>` : ''}
        </div>
        
        <div class="card-footer">
          <a href="${c.href}" target="_blank" class="card-register-btn">ƒêƒÉng k√Ω ngay</a>
          <a href="${c.href}" target="_blank" class="card-details-btn">Chi ti·∫øt</a>
        </div>
      </article>`}).join(''));

    // Update mobile scroll indicator after cards are rendered
    if (window.updateMobileScrollIndicator) {
      setTimeout(window.updateMobileScrollIndicator, 100);
    }
  }

  /* ====== Debounce helper ====== */
  const debounce = (fn, ms = 250) => {
    let id;
    return (...args) => {
      clearTimeout(id);
      id = setTimeout(() => fn.apply(this, args), ms);
    };
  };

  /* ========================================================================
   *  Desktop Upcoming Highlights renderer
   * ======================================================================*/
  function renderHighlights(courseData){
    const container = $('#desktopHighlights').empty();
    if($(window).width()<1200) return; // only desktop

    const today = new Date();
    today.setHours(0, 0, 0, 0); // Set to start of day for accurate comparison
    const parseDate = (d)=>{ if(!d||d.includes('--')) return null; const [dd,mm,yy]=d.split('/'); return new Date(yy,mm-1,dd); };

    const groups = [
      {id:'hcm',label:'T·∫°i H·ªì Ch√≠ Minh',  match: c=>/H·ªì Ch√≠ Minh/i.test(c.loc)},
      {id:'hn', label:'T·∫°i H√† N·ªôi',   match: c=>/H√† N·ªôi/i.test(c.loc)},
      {id:'other',label:'T·ªânh/Th√†nh Ph·ªë Kh√°c', match: c=>!/(H·ªì Ch√≠ Minh|H√† N·ªôi|Zoom)/i.test(c.loc)},
      {id:'online',label:'Tr·ª±c Tuy·∫øn Qua Zoom', match: c=>/zoom/i.test(c.loc)}
    ];

    let htmls = [];
    groups.forEach(g=>{
      // D·ªØ li·ªáu cho highlights gi·ªù ƒë√£ ƒë∆∞·ª£c l·ªçc tr∆∞·ªõc, ch·ªâ c·∫ßn nh√≥m v√† s·∫Øp x·∫øp.
      const list = courseData
        .filter(c=>g.match(c))
        .sort((a,b)=>parseDate(a.start)-parseDate(b.start));

      const formatDM = d=>{const [dd,mm] = d.split('/'); return `${dd}/${mm}`};
      const items=list.map(c => {
        const specialClass = specialCourses.includes(c.course) ? 'special-course-highlight' : '';
        const dateDisplay = c.start === c.end ? formatDM(c.start) : `${formatDM(c.start)} ‚Äì ${formatDM(c.end)}`;
        return `<li><a href="${c.href}" target="_blank" class="course-name ${specialClass}">${c.course}</a><span class="course-date">${dateDisplay}</span></li>`;
      }).join('');

      // Special handling for "other" group to show location
      if (g.id === 'other') {
        const itemsWithLocation = list.map(c => {
          const specialClass = specialCourses.includes(c.course) ? 'special-course-highlight' : '';
          const dateDisplay = c.start === c.end ? formatDM(c.start) : `${formatDM(c.start)} ‚Äì ${formatDM(c.end)}`;
          return `<li>
            <div class="course-title-group">
              <a href="${c.href}" target="_blank" class="course-name ${specialClass}">${c.course}</a>
              <span class="course-location">(${c.loc})</span>
            </div>
            <span class="course-date">${dateDisplay}</span>
          </li>`;
        }).join('');
        const tileContent = `
          <article id="tile-${g.id}" class="upcoming-tile">
            <h3>${g.label}</h3>
            <div class="tile-divider"></div>
            <ul>${itemsWithLocation || '<li>ƒêang c·∫≠p nh·∫≠t‚Ä¶</li>'}</ul>
          </article>`;
        htmls.push(tileContent);
      } else {
        htmls.push(`
          <article id="tile-${g.id}" class="upcoming-tile">
            <h3>${g.label}</h3>
            <div class="tile-divider"></div>
            <ul>${items || '<li>ƒêang c·∫≠p nh·∫≠t‚Ä¶</li>'}</ul>
          </article>`);
      }
    });
    container.html(htmls.join(''));
  }

  /* ========================================================================
   *  Init
   * ======================================================================*/
  $(async () => {
    const allCourseData = await getData();

    // L·ªçc tr∆∞·ªõc t·∫•t c·∫£ d·ªØ li·ªáu ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã c√°c kh√≥a h·ªçc ch∆∞a k·∫øt th√∫c (end_date >= today)
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const parseDateForFilter = (dateStr) => {
        if (!dateStr || dateStr.includes('--')) return null;
        const [dd, mm, yyyy] = dateStr.split('/');
        return new Date(yyyy, mm - 1, dd);
    };
    const courseData = allCourseData.filter(course => {
      const endDate = parseDateForFilter(course.end);
      // Gi·ªØ l·∫°i kh√≥a h·ªçc n·∫øu ng√†y k·∫øt th√∫c c·ªßa n√≥ l·ªõn h∆°n ho·∫∑c b·∫±ng h√¥m nay
      return endDate ? endDate.getTime() >= today.getTime() : false;
    });

    fillCards(courseData);
    renderHighlights(courseData);

    // Initialize mobile scroll indicator
    initMobileScrollIndicator();

    const dt = $('#courses').DataTable({
      data: courseData,
      columns: [
        { data: 'course' },
        { data: 'speaker' },
        { data: null }, // Placeholder for the combined date range
        { data: 'loc' },
        { data: 'mode' },
        { data: 'start', visible: false }, // Hidden column for sorting
        { data: 'end', visible: false } // Hidden column
      ],
      columnDefs: [
        {
          targets: 2, // The new "Th·ªùi gian" column
          orderData: [5], // Sort this column using the 'start' date data (index 5)
          render: function (data, type, row) {
            const formatDM = d => {
              if (!d || d.includes('--')) return '??/??';
              const [dd, mm] = d.split('/');
              return `${dd}/${mm}`;
            };
            return row.start === row.end
              ? formatDM(row.start)
              : `${formatDM(row.start)} - ${formatDM(row.end)}`;
          }
        },
        { type: 'ddmmyyyy', targets: [5] }, // Apply date sorting to the hidden start column
        {
          targets: 3, /* ƒê·ªãa ƒëi·ªÉm: now at index 3 */
          render: (data) => `${data} ${/^\+?\d/.test(data.trim()) ? `<a href="tel:${data.trim()}" class="phone-link" title="G·ªçi ƒëi·ªán"><i class="fas fa-phone"></i></a>` : ''}`
        },
        { targets: 4, render: (d) => createModeBadge(d) } /* H√¨nh th·ª©c: now at index 4 */
      ],
      createdRow: (row, data) => {
        $(row).attr('data-href', data.href);
        if (specialCourses.includes(data.course)) {
          $('td:eq(0)', row).addClass('special-course-highlight');
        }
      },
      order: [[2, 'asc']], // Sort by the new "Th·ªùi gian" column
      pageLength: -1, // Hi·ªÉn th·ªã t·∫•t c·∫£ entries
      lengthMenu: [], // ·∫®n menu length
      dom: 'rt', // Ch·ªâ hi·ªÉn th·ªã table v√† processing
      info: false, // ·∫®n th√¥ng tin s·ªë l∆∞·ª£ng entries
      paging: false, // ·∫®n ph√¢n trang
      autoWidth: false,
      initComplete: function() {
        const isDesktop = window.innerWidth > 1200;
        const topValue = isDesktop ? '0px' : '80px';
        
        $('#courses thead th').css({
          'position': 'sticky',
          'top': topValue,
          'z-index': '50',
          'background': '#2EC7BE', /* M√†u xanh ng·ªçc nh·∫°t */
          'box-shadow': '0 2px 2px -1px rgba(0, 0, 0, 0.4)'
        });
      },
      drawCallback: function() {
        const isDesktop = window.innerWidth > 1200;
        const topValue = isDesktop ? '0px' : '80px';
        
        $('#courses thead th').css({
          'position': 'sticky',
          'top': topValue,
          'z-index': '50',
          'background': '#2EC7BE' /* M√†u xanh ng·ªçc nh·∫°t */
        });
      }
    });

    /* ‚ñ∏ Global search: b·ªè d·∫•u + ƒë·ªìng b·ªô hai view */
    $('#globalSearch').on('input', debounce(function () {
      dt.search('').draw(); // X√≥a t√¨m ki·∫øm m·∫∑c ƒë·ªãnh ƒë·ªÉ s·ª≠ d·ª•ng plugin t√πy ch·ªânh
    }));

    /* ‚ñ∏ Handle resize for sticky positioning */
    $(window).on('resize', debounce(function() {
      const isDesktop = window.innerWidth > 1200;
      const topValue = isDesktop ? '0px' : '80px';
      
      $('#courses thead th').css('top', topValue);
      $('.dataTables_scrollHead').css('top', topValue);
    }, 250));

    dt.on('draw.dt', () => {
      fillCards(dt.rows({ search: 'applied' }).data().toArray());
      // Update scroll indicator after cards are refreshed
      if (window.updateMobileScrollIndicator) {
        setTimeout(window.updateMobileScrollIndicator, 100);
      }
    });

    /* ‚ñ∏ row click to open */
    $('#courses tbody').on('click', 'tr', function (e) {
      if ($(e.target).closest('a').length) return; /* avoid when clicking phone icon */
      const href = $(this).data('href');
      if (href && href !== '#') window.open(href, '_blank');
    });

    /* ========================================================================
     *  Mobile Scroll Indicator Logic
     * ======================================================================*/
    function initMobileScrollIndicator() {
      const $indicator = $('#mobileScrollIndicator');
      const $mobileContainer = $('#mobileCardContainer');
      let isIndicatorVisible = false;
      let hideTimeout;

      // Ki·ªÉm tra xem c√≥ ph·∫£i mobile view kh√¥ng
      function isMobileView() {
        return window.innerWidth <= 1200;
      }

      // Ki·ªÉm tra xem c√≥ ƒë·ªß n·ªôi dung ƒë·ªÉ scroll kh√¥ng
      function hasScrollableContent() {
        return document.documentElement.scrollHeight > window.innerHeight + 100; // Th√™m buffer 100px
      }

      // Ki·ªÉm tra xem ƒë√£ scroll g·∫ßn ƒë·∫øn cu·ªëi ch∆∞a
      function isNearBottom() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        const distanceFromBottom = documentHeight - (scrollTop + windowHeight);
        
        // ·∫®n indicator khi c√≤n c√°ch ƒë√°y 150px
        return distanceFromBottom <= 150;
      }

      // Hi·ªÉn th·ªã indicator v·ªõi animation smooth
      function showIndicator() {
        if (isIndicatorVisible) return;
        
        $indicator.removeClass('hiding').addClass('visible');
        isIndicatorVisible = true;
        
        // Clear any existing hide timeout
        if (hideTimeout) {
          clearTimeout(hideTimeout);
          hideTimeout = null;
        }
      }

      // ·∫®n indicator v·ªõi animation smooth
      function hideIndicator() {
        if (!isIndicatorVisible) return;
        
        $indicator.removeClass('visible').addClass('hiding');
        isIndicatorVisible = false;
        
        // Ho√†n to√†n ·∫©n element sau khi animation k·∫øt th√∫c
        hideTimeout = setTimeout(() => {
          $indicator.removeClass('hiding');
        }, 300); // Match v·ªõi animation duration
      }

      // Main logic ƒë·ªÉ quy·∫øt ƒë·ªãnh hi·ªÉn th·ªã/·∫©n indicator
      function updateIndicatorVisibility() {
        if (!isMobileView()) {
          hideIndicator();
          return;
        }

        // Ch·ªâ hi·ªÉn th·ªã khi:
        // 1. ƒêang ·ªü mobile view
        // 2. C√≥ ƒë·ªß n·ªôi dung ƒë·ªÉ scroll
        // 3. Ch∆∞a scroll g·∫ßn ƒë·∫øn cu·ªëi
        // 4. Mobile container c√≥ cards
        if (hasScrollableContent() && !isNearBottom() && $mobileContainer.children().length > 0) {
          showIndicator();
        } else {
          hideIndicator();
        }
      }

      // Throttle scroll events ƒë·ªÉ optimize performance
      let scrollTimeout;
      function throttledScrollHandler() {
        if (scrollTimeout) return;
        
        scrollTimeout = setTimeout(() => {
          updateIndicatorVisibility();
          scrollTimeout = null;
        }, 16); // ~60fps
      }

      // Event listeners
      $(window).on('scroll', throttledScrollHandler);
      $(window).on('resize', debounce(updateIndicatorVisibility, 250));

      // Initial check
      updateIndicatorVisibility();

      // Expose update function globally ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ b√™n ngo√†i
      window.updateMobileScrollIndicator = updateIndicatorVisibility;
    }
  });
</script>
</body>
</html>
